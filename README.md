# o11y üöÄ  
  
–ù–∞ –≤–º –≤ –æ–±–ª–∞–∫–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã —Å–µ—Ä–≤–∏—Å, –°–£–ë–î, –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä, —Å—Ç–µ–∫ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ –∏ –∞–ª–µ—Ä—Ç—ã –≤ —Ç–≥ –∫–∞–Ω–∞–ª.  
  
> VM IP: **51.250.86.234**  
  
---  
  
## –°–æ—Å—Ç–∞–≤  
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç           | URL                         | –£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ          |     |
| ------------------- | --------------------------- | ----------------------- | --- |
| FastAPI service     | `http://51.250.86.234:8000` | `/docs` ‚Äì Swagger       |     |
| Load Generator (Go) | `http://51.250.86.234:8080` | UI –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ |     |
| Prometheus          | `http://51.250.86.234:9090` | ‚Äî                       |     |
| Alertmanager        | `http://51.250.86.234:9093` | ‚Äî                       |     |
| Grafana             | `http://51.250.86.234:3000` | admin / admin           |     |
| Telegram –∫–∞–Ω–∞–ª      | t.me/pypytyty               | –ø—É–±–ª–∏—á–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã        |     |
  
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å—Ç–∞—Ä—Ç—É—é—Ç –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π Docker Compose, –∫–æ–Ω—Ñ–∏–≥–∏ –ª–µ–∂–∞—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `infra/`.  
  
---  
  
## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–ª–µ—Ä—Ç—ã  
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–≥—Ä—É–∑–∫–∏: `http://51.250.86.234:8080`  
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:  
   * **Path** ‚Äì `/db_tx,/slow`  
   * **RPS** ‚Äì `220`  
   * **Duration** ‚Äì `200`  
3. –ù–∞–∂–º–∏—Ç–µ *Start*. –ß–µ—Ä–µ–∑ ~30 —Å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–µ–≤—ã—Å—è—Ç –ø–æ—Ä–æ–≥–∏:  
   * `pg_stat_database_xact_commit` > **100 TPS**  
   * p99 latency > **500 ms**  
4. –í —Ç–≥ –∫–∞–Ω–∞–ª–µ –ø–æ—è–≤—è—Ç—Å—è –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞–ª–µ—Ä—Ç–∞.

  `–ï—Å–ª–∏ –±—É–¥–µ—à—å –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞–ª–µ—Ä—Ç—ã –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏, —Ç–æ –≤ –ø—É—Ç–∏ –æ—Å—Ç–∞–≤—å —á—Ç–æ-—Ç–æ –æ–¥–Ω–æ –∏ –≤—ã—Å—Ç–∞–≤—å –∑–Ω–∞—á–µ–Ω–∏–µ RPS ~110-120, —Ç–∞–∫ –∫–∞–∫ –µ—Å–ª–∏ 2 —Å—Ä–∞–∑—É, —Ç–æ –æ–Ω –¥–µ–ª–∏—Ç —Ä–ø—Å –ø–æ–ø–æ–ª–∞–º –Ω–∞ –∫–∞–∂–¥—ã–π –ø—É—Ç—å`
---  
  
## –ß—Ç–æ –≥–¥–µ –ª–µ–∂–∏—Ç  
| –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |  
|------|-------------|  
| `app/` | FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `/db_tx`, `/slow`, `/health`, `/docs` |  
| `load-go/` | Go-—Å–µ—Ä–≤–∏—Å —Å UI –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTTP-–Ω–∞–≥—Ä—É–∑–∫–∏ |  
| `infra/prometheus/` | `prometheus.yml` + –ø—Ä–∞–≤–∏–ª–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π |  
| `infra/alertmanager/` | `config.yml` –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ Telegram |  
| `infra/grafana/provisioning/` | –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ datasources & dashboards |  
| `data/` | CSV-—Ñ–∞–π–ª (‚âà1500 —Å—Ç—Ä–æ–∫) –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –≤ Postgres |  
  
---  
  
## –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞  
| Alert | –í—ã—Ä–∞–∂–µ–Ω–∏–µ | –ü–æ—Ä–æ–≥ / for |  
|-------|-----------|-------------|  
| **HighDBRPS** | `rate(pg_stat_database_xact_commit{datname="postgres"}[15s])` | >100 TPS, 30 s |  
| **HighP99Latency** | `1000*histogram_quantile(0.99, sum by(le)(rate(http_request_duration_seconds_bucket[5m])))` | >500 ms, 30 s |  
  
–í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `infra/prometheus/rules/app_alerts.yml`.  
  
---  
  
## –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥ (IaC)  
* **Prometheus** ‚Äì –∫–æ–Ω—Ñ–∏–≥ + rules  
* **Alertmanager** ‚Äì –∫–æ–Ω—Ñ–∏–≥ —Å Telegram receiver  
* **Grafana** ‚Äì datasources –∏ dashboards provisioning  
  
–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–æ—Å—Ç–æ: –ø—Ä–∞–≤–∏–º —Ñ–∞–π–ª—ã ‚Üí `docker compose up -d --build prometheus alertmanager grafana`.  
  
---  

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã  
```bash  
# –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤  
docker compose logs -f app         # FastAPI  
docker compose logs -f load_go     # –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä  
  
# –¥–æ—Å—Ç—É–ø –≤ psql  
docker compose exec postgres psql -U postgres  
  
# –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–ª–µ—Ä—Ç–æ–≤  
curl -s http://localhost:9090/api/v1/alerts | jq  
```  
